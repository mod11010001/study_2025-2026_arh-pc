;-----------------------------------------------------------------
; Программа вычисления суммы значений f(x) = 7*(x+1) с использованием
; подпрограммы для f(x).
;-----------------------------------------------------------------
%include 'in_out.asm'

SECTION .data
msg db "Результат: ",0

SECTION .text
global _start

_start:
    pop ecx             ; Извлекаем из стека количество аргументов
    pop edx             ; Извлекаем из стека имя программы
    sub ecx, 1          ; Уменьшаем `ecx` на 1 
    
    mov esi, 0          ; Регистр для хранения промежуточной суммы

next:
    cmp ecx, 0          ; Проверяем, есть ли ещё аргументы
    jz _end             ; Если аргументов нет – выходим из цикла
    
    pop eax             ; Извлекаем адрес аргумента из стека
    call atoi           ; Преобразуем строку в число (x теперь в EAX)
    
    call _calc_f_x      ; ВЫЗОВ ПОДПРОГРАММЫ: EAX = f(x)
    
    add esi, eax        ; Добавляем f(x) к промежуточной сумме
    loop next           ; Переход к следующему аргументу

_end:
    mov eax, msg        ; Выводим сообщение "Результат: "
    call sprint
    mov eax, esi        ; Загружаем сумму в eax
    call iprintLF       ; Печатаем результат
    call quit           ; Завершаем программу

; -----------------------------------------------------------------
; ПОДПРОГРАММА для вычисления f(x) = 7 * (x + 1)
; Предполагается, что x находится в регистре EAX.
; Результат f(x) возвращается в регистре EAX.
; -----------------------------------------------------------------
_calc_f_x:
    add eax, 1          ; EAX = x + 1
    imul eax, 7         ; EAX = 7 * (x + 1)
    ret                 ; Возвращение из подпрограммы